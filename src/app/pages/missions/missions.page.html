<ion-header>
  <ion-toolbar color="title">
    <ion-title>Mission List</ion-title>
    <ion-buttons slot="end">
      <ion-button id="popover-button">
        <ion-icon icon="ellipsis-vertical" slot="icon-only"></ion-icon>
      </ion-button>
    </ion-buttons>
  </ion-toolbar>
</ion-header>

<ion-content>
  <ion-segment (ionChange)="segmentChanged($event)" [(ngModel)]="selectedSegment" id="segment">
    <ion-segment-button value="Card View">
      <ion-label>Card View</ion-label>
    </ion-segment-button>
    <ion-segment-button value="Notepad View">
      <ion-label>Notepad View</ion-label>
    </ion-segment-button>
  </ion-segment>
  <!-- ion search -->
  <ion-searchbar (ionChange)="onSearchChange($event)" placeholder="Search"></ion-searchbar>
  <swiper class="custom-swiper" (slideChange)="onSlideChange()" (swiper)="setSwiperInstance($event)">
    <ng-template swiperSlide>
      <ng-container *ngFor="let mission of filteredMissions; let i = index;">
        <ion-card-content>
          <app-flipper [customFrontCss]="mission.countersAmountTotal >= mission.endAmount ? 'card-completed' : ''">
            <div front>
              <ion-row>
                <ion-col size="7" [routerLink]="['/counters', mission.id]">
                  {{mission.countersAmountTotal}}/{{mission.endAmount}} {{mission.name}}
                </ion-col>
                <ion-col size="4" [routerLink]="['/counters', mission.id]">
                  {{mission.percentage + '%'}}
                </ion-col>
                <ion-col size="1" (click)="onFlip(i)">
                  <ion-icon name="settings-outline"></ion-icon>
                </ion-col>
              </ion-row>
            </div>
            <div back>
              <ion-row>
                <ion-col size="3">
                  <div [routerLink]="['update', mission.id]">
                    <ion-icon name="create-outline"></ion-icon>
                    Edit
                  </div>
                </ion-col>
                <ion-col size="3">
                  <div (click)="onDeleteMissionClick(mission.id)">
                    <ion-icon name="trash-outline"></ion-icon>
                    Delete
                  </div>
                </ion-col>
                <ion-col offset="5" size="1" (click)="onFlip(i)">
                  <ion-icon name="arrow-undo-outline"></ion-icon>
                </ion-col>
              </ion-row>
            </div>
          </app-flipper>
        </ion-card-content>
      </ng-container>
    </ng-template>
    <ng-template swiperSlide>
      <ng-container *ngFor="let mission of filteredMissions">
        <div [routerLink]="['/counters', mission.id]">
          <p class="ion-margin">
            {{mission.name}} {{mission.countersAmountTotal}}/{{mission.endAmount}}
            <ng-container *ngIf="mission.countersAmountTotal >= mission.endAmount">
              <ion-icon class="icon" name="checkmark-circle-outline"></ion-icon>
            </ng-container>
          </p>
        </div>
      </ng-container>
    </ng-template>
  </swiper>
</ion-content>


<ion-popover trigger="popover-button" [dismissOnSelect]="true">
  <ng-template>
    <ion-content>
      <ion-list>
        <ion-item [button]="true" [detail]="false" [routerLink]="['create']">Add new Mission</ion-item>
        <ion-item [button]="true" [detail]="false" (click)="presentPicker()">Filter Options</ion-item>
        <ion-item [button]="true" [detail]="false" (click)="presentPicker()">Order Options</ion-item>
        <ion-item [button]="true" [detail]="false" [routerLink]="['/settings']">Settings</ion-item>
      </ion-list>
    </ion-content>
  </ng-template>
</ion-popover>